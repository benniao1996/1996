# 一、iostat
```
yum install sysstat -y


iostat -mtx 2

[root@test-io-02-mysql ~]# iostat -d -x -k 1 10
Linux 3.10.0-957.12.1.el7.x86_64 (test-io-02-mysql)         05/30/2019      _x86_64_        (24 CPU)

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00     0.00    0.00    0.00     0.02     0.01   129.61     0.00    0.81    0.26    6.88   0.21   0.00
sdb               0.00     9.38    0.01   21.15     0.38   436.30    41.26     0.21    9.84    9.79    9.84   7.09  15.00
dm-0              0.00     0.00    0.02   26.81     0.35   432.87    32.29     0.21    7.79   10.18    7.79   5.45  14.63
dm-1              0.00     0.00    0.00    0.00     0.00     0.00    57.42     0.00   21.41   21.41    0.00  19.91   0.00
dm-2              0.00     0.00    0.00    0.51     0.02     3.42    13.52     0.01   12.00   16.15   11.99  10.74   0.55

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00
sdb               0.00     0.00    0.00    2.00     0.00     4.00     4.00     0.01   32.50    0.00   32.50   4.50   0.90
dm-0              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.01    0.00    0.00    0.00   0.00   0.90
dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00
dm-2              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00


rrqm/s：每秒这个设备相关的读取请求有多少被Merge了（当系统调用需要读取数据的时候，VFS将请求发到各个FS，如果FS发现不同的读取请求读取的是相同Block的数据，FS会将这个请求合并Merge）；wrqm/s：每秒这个设备相关的写入请求有多少被Merge了。

rsec/s：每秒读取的扇区数；
wsec/：每秒写入的扇区数。
rKB/s：The number of read requests that were issued to the device per second；
wKB/s：The number of write requests that were issued to the device per second；
avgrq-sz 平均请求扇区的大小
avgqu-sz 是平均请求队列的长度。毫无疑问，队列长度越短越好。    
await：  每一个IO请求的处理的平均时间（单位是微秒毫秒）。这里可以理解为IO的响应时间，一般地系统IO响应时间应该低于5ms，如果大于10ms就比较大了。
         这个时间包括了队列时间和服务时间，也就是说，一般情况下，await大于svctm，它们的差值越小，则说明队列时间越短，反之差值越大，队列时间越长，说明系统出了问题。
svctm    表示平均每次设备I/O操作的服务时间（以毫秒为单位）。如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，         系统上运行的应用程序将变慢。
%util： 在统计时间内所有处理IO时间，除以总共统计时间。例如，如果统计间隔1秒，该设备有0.8秒在处理IO，而0.2秒闲置，那么该设备的%util = 0.8/1 = 80%，所以该参数暗示了设备的繁忙程度
。一般地，如果该参数是100%表示设备已经接近满负荷运行了（当然如果是多磁盘，即使%util是100%，因为磁盘的并发能力，所以磁盘使用未必就到了瓶颈）。


```

# 二、sar
```
 1、sar -u 1 5
输出CPU使用情况的统计信息，每秒输出一次，一共输出100次
17时06分01秒       CPU     %user     %nice   %system   %iowait     %idle
17时06分02秒       all      1.27      0.00      0.51      1.01     97.22
17时06分03秒       all      0.00      0.00      0.00      0.00    100.00
17时06分04秒       all      0.00      0.00      0.00      0.00    100.00
17时06分05秒       all      0.25      0.00      0.00      0.00     99.75
17时06分06秒       all      0.00      0.00      0.00      0.51     99.49
Average:          all      0.30      0.00      0.10      0.30     99.29

CPU      all 表示统计信息为所有 CPU 的平均值。                                       
%user    显示在用户级别(application)运行使用 CPU 总时间的百分比。                  
%nice    显示在用户级别，用于nice操作，所占用 CPU 总时间的百分比。            
%system 在核心级别(kernel)运行所使用 CPU 总时间的百分比。      
%iowait 显示用于等待I/O操作占用 CPU 总时间的百分比。
%steal   管理程序(hypervisor)为另一个虚拟进程提供服务而等待虚拟 CPU 的百分比。
%idle    显示 CPU 空闲时间占用 CPU 总时间的百分比。

tips：
若 %iowait 的值过高，表示硬盘存在I/O瓶颈
若 %idle 的值高但系统响应慢时，有可能是 CPU 等待分配内存，此时应加大内存容量
若 %idle 的值持续低于 10，则系统的 CPU 处理能力相对较低，表明系统中最需要解决的资源是 CPU。

2、sar -b 1 5
显示I/O和传送速率的统计信息
17时09分07秒       tps      rtps      wtps   bread/s   bwrtn/s
17时09分08秒      3.12      3.12      0.00     25.00      0.00
17时09分09秒     89.58      6.25     83.33    141.67    733.33
17时09分10秒     42.71      9.38     33.33    141.67    600.00
17时09分11秒      2.11      2.11      0.00     16.84      0.00
17时09分12秒      1.04      0.00      1.04      0.00    175.00
Average:        27.77      4.18     23.59     65.14    302.30

tps     每秒钟物理设备的 I/O 传输总量                   
rtps    每秒钟从物理设备读入的数据总量                 
wtps    每秒钟向物理设备写入的数据总量                 
bread/s 每秒钟从物理设备读入的数据量，单位为 块/s   
bwrtn/s 每秒钟向物理设备写入的数据量，单位为 块/s   

3、sar -c
每秒钟创建的进程数
15时10分01秒      1.35
15时20分01秒      1.01
15时30分01秒      0.59
15时40分01秒      1.35
15时50分01秒      0.99
16时00分01秒      0.57
16时10分01秒      1.33
16时20分01秒      1.02
16时30分01秒      0.57
16时40分01秒      1.33
16时50分01秒      1.07
17时00分01秒      0.56
17时10分01秒      1.32

4、sar -n DEV 1 5
输出网络设备状态的统计信息
17时13分42秒     IFACE   rxpck/s   txpck/s   rxbyt/s   txbyt/s   rxcmp/s   txcmp/s rxmcst/s
17时13分43秒      eth1   3669.70   4156.57 368362.63 2747714.14      0.00      0.00      0.00
17时13分44秒      eth1   2689.11   2585.15 289661.39 701461.39      0.00      0.00      0.00
17时13分45秒      eth1   3746.00   4077.00 415178.00 2605720.00      0.00      0.00      0.00
17时13分46秒      eth1   3096.00   3241.00 327916.00 1597320.00      0.00      0.00      0.00
17时13分47秒      eth1   2910.00   2834.00 312632.00 957903.00      0.00      0.00      0.00
Average:         eth1   3220.20   3375.60 342592.60 1717931.20      0.00      0.00      0.00

IFACE      网络设备名                          
rxpck/s    每秒接收的包总数                 
txpck/s    每秒传输的包总数                  
rxbyt/s    每秒接收的字节（byte）总数        
txbyt/s    每秒传输的字节（byte）总数        
rxcmp/s    每秒接收压缩包的总数              
txcmp/s    每秒传输压缩包的总数              
rxmcst/s   每秒接收的多播（multicast）包的总数

5、sar -q 1 5
输出进程队列长度和平均负载状态统计信息
17时16分28秒   runq-sz plist-sz   ldavg-1   ldavg-5 ldavg-15
17时16分29秒         0       160      0.26      0.11      0.03
17时16分30秒         0       160      0.26      0.11      0.03
17时16分31秒         0       160      0.24      0.11      0.03
17时16分32秒         0       160      0.24      0.11      0.03
17时16分33秒         0       160      0.24      0.11      0.03
Average:            0       160      0.25      0.11      0.03

runq-sz   运行队列的长度（等待运行的进程数）                                     
plist-sz 进程列表中进程（processes）和线程（threads）的数量                    
ldavg-1   最后1分钟的系统平均负载（System load average）                         
ldavg-5   过去5分钟的系统平均负载                                                
ldavg-15 过去15分钟的系统平均负载                                              

6、sar -r
输出内存和交换空间的统计信息

7、iostat

iostat -mtx 2

tps 每秒钟物理设备的 I/O 传输总 量。                                                                                          
Blk_read 读入的数据总量，单位为 块。                                                                                          
Blk_wrtn 写入的数据总量，单位为 块。                                                                                          
kB_read 读入的数据总量，单位为 KB。                                                                                           
kB_wrtn 写入的数据总量，单位为 KB。                                                                                           
MB_read 读入的数据总量，单位为 MB。                                                                                           
MB_wrtn 写入的数据总量，单位为 MB。                                                                                           
Blk_read/s 每秒从驱动器读入的数据量，单位为 块 /s。                                                                           
Blk_wrtn/s 每秒向驱动器写入的数据量，单位为 块 /s。                                                                           
kB_read/s 每秒从驱动器读入的数据量，单位为 KB/s。                                                                             
kB_wrtn/s 每秒向驱动器写入的数据量，单位为 KB/s。                                                                             
MB_read/s 每秒从驱动器读入的数据量，单位为 MB/s。                                                                             
MB_wrtn/s 每秒向驱动器写入的数据量，单位为MB/s。
rrqm/s 将读入请求合并后，每秒发送到设备的读入请求数。   
wrqm/s 将写入请求合并后，每秒发送到设备的写入请求数。
r/s 每秒发送到设备的读入请求 数。                                                                                             
w/s 每秒发送到设备的写入请求 数。                                                                                             
rsec/s 每秒从设备读入的扇区 数。                                                                                              
wsec/s 每秒向设备写入的扇区 数。                                                                                              
rkB/s 每秒从设备读入的数据量，单位为 KB/s。                                                                                  
wkB/s 每秒向设备写入的数据量，单位为 KB/s。                                                                                  
rMB/s 每秒从设备读入的数据量，单位为 MB/s。                                                                                  
wMB/s 每秒向设备写入的数据量，单位为 MB/s。                                                                                  
avgrq-sz 发送到设备的请求的平均大小，单位为扇 区。                                                                            
avgqu-sz 发送到设备的请求的平均队列长 度。                                                                                    
await I/O请求平均执行时间。包括发送请求和执行的时间。单位为毫 秒。                                                   
svctm 发送到设备的I/O请求的平均执行时间。单位为毫 秒。                                                                      
%util 在I/O请求发送到设备期间，占用CPU时间的百分比。用于显示设备的带宽利用率。当这个值接近100%时，表示设备带宽已经占满。
```


参考资料：

https://blog.csdn.net/shaochenshuo/article/details/76212566

https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858810.html    Linux IO实时监控iostat命令详解 

https://blog.csdn.net/a454213722/article/details/25727347   【io 负载分析 第一步】linux 安装sysstat使用iostat、mpstat、sar、sa
